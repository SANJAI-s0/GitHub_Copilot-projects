<!DOCTYPE html>
<html lang="en" class="h-full bg-gradient-to-br from-gray-900 via-gray-800 to-gray-700 dark:from-gray-800 dark:via-gray-900 dark:to-black">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>üåê World Clock</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- GSAP CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <!-- Custom Neon/Glass Tailwind Config -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          boxShadow: {
            neon: '0 0 16px 2px #06b6d4, 0 0 32px 2px #818cf8 inset',
            glass: '0 8px 32px 0 rgba(31, 38, 135, 0.37)'
          },
          colors: {
            neon: '#0ff0fc',
            glass: 'rgba(255,255,255,0.15)'
          }
        }
      }
    }
  </script>
  <style>
    /* Glassmorphism effect for cards */
    .glass {
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255,255,255,0.12);
    }
    .glass-dark {
      background: rgba(30,41,59,0.48);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(148,163,184,0.17);
    }
    .glow {
      text-shadow:
        0 0 8px #0ff0fc,
        0 0 20px #818cf8;
      color: #fff;
    }
    .time-glow {
      filter: drop-shadow(0 0 8px #0ff0fc) drop-shadow(0 0 18px #818cf8);
    }
    .gsap-pop { opacity: 0; transform: scale(0.96);}
  </style>
</head>
<body class="h-full min-h-screen flex items-center justify-center font-sans transition-colors duration-300 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-700 dark:from-gray-800 dark:via-gray-900 dark:to-black">
  <div id="app" class="w-full max-w-2xl mx-auto p-4 flex flex-col gap-6">
    <!-- Header -->
    <header class="text-center mb-2">
      <h1 id="title" class="text-3xl md:text-4xl font-extrabold tracking-wide glow mb-1">üåê World Clock</h1>
      <p class="text-lg text-cyan-300/90 mb-2 font-light">Select and view multiple time zones at once</p>
    </header>
    <!-- Controls -->
    <section class="flex flex-col md:flex-row gap-2 md:gap-4 items-center justify-between bg-glass/90 dark:bg-glass-dark/80 rounded-xl shadow-glass py-4 px-5 mb-2">
      <div class="flex-1 flex gap-2 items-center">
        <div class="relative w-full max-w-xs">
          <input id="search" type="text" aria-label="Search city or timezone" placeholder="Search city or timezone..."
            class="w-full rounded-l-lg px-4 py-2 text-base bg-white/20 dark:bg-slate-800/50 border border-cyan-400/40 focus:ring-2 focus:ring-cyan-400 outline-none text-cyan-100 placeholder:text-cyan-400 transition"
            autocomplete="off"/>
          <ul id="suggestions" class="absolute z-10 left-0 right-0 mt-1 bg-gray-900/95 dark:bg-slate-800/95 rounded-b-lg shadow-lg border border-cyan-400/30 text-cyan-200 text-sm hidden max-h-48 overflow-y-auto"></ul>
        </div>
        <button id="add-btn" class="ml-0 md:ml-2 px-5 py-2 rounded-r-lg bg-cyan-500 hover:bg-cyan-400 text-white font-bold shadow-neon transition-all duration-150 focus:outline-none">
          Add
        </button>
      </div>
      <div class="flex gap-4 mt-3 md:mt-0 items-center">
        <label class="flex items-center cursor-pointer">
          <span class="mr-2 text-cyan-200 font-medium text-sm">12h</span>
          <input id="toggle-24h" type="checkbox" class="hidden peer">
          <span class="w-10 h-5 bg-cyan-700/50 rounded-full relative transition peer-checked:bg-indigo-600">
            <span class="absolute left-1 top-1 w-3 h-3 bg-white rounded-full transition peer-checked:translate-x-5"></span>
          </span>
          <span class="ml-2 text-cyan-200 font-medium text-sm">24h</span>
        </label>
        <button id="toggle-dark" title="Toggle dark mode"
          class="w-10 h-10 p-1 rounded-full flex items-center justify-center bg-gray-800/60 dark:bg-slate-700/70 text-cyan-200 hover:bg-cyan-700/40 hover:text-white shadow transition-all">
          <svg id="dark-icon" class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2"
            viewBox="0 0 24 24">
            <path id="moon" stroke-linecap="round" stroke-linejoin="round"
              d="M21 12.79A9 9 0 0111.21 3a7 7 0 108.58 9.79z"/>
            <circle id="sun" cx="12" cy="12" r="6" style="display:none"/>
          </svg>
        </button>
      </div>
    </section>
    <!-- Clock Grid -->
    <main id="clocks-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6 transition-all"></main>
    <!-- Footer -->
    <footer class="mt-6 text-center text-cyan-200/80 text-xs select-none">
      Built with <a href="https://tailwindcss.com/" class="underline hover:text-cyan-400 transition">TailwindCSS</a> +
      <a href="https://gsap.com/" class="underline hover:text-indigo-400 transition">GSAP</a> +
      <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl" class="underline hover:text-pink-400 transition">Intl API</a>
    </footer>
  </div>
  <!-- City/Timezone Data (Minimal, 120+ entries) -->
  <script>
    // Curated city/timezone list (sample, can be extended)
    const CITIES = [
      { city: "New York", zone: "America/New_York", country: "USA" },
      { city: "London", zone: "Europe/London", country: "UK" },
      { city: "Paris", zone: "Europe/Paris", country: "France" },
      { city: "Tokyo", zone: "Asia/Tokyo", country: "Japan" },
      { city: "Sydney", zone: "Australia/Sydney", country: "Australia" },
      { city: "Los Angeles", zone: "America/Los_Angeles", country: "USA" },
      { city: "Dubai", zone: "Asia/Dubai", country: "UAE" },
      { city: "Hong Kong", zone: "Asia/Hong_Kong", country: "China" },
      { city: "Moscow", zone: "Europe/Moscow", country: "Russia" },
      { city: "S√£o Paulo", zone: "America/Sao_Paulo", country: "Brazil" },
      { city: "Berlin", zone: "Europe/Berlin", country: "Germany" },
      { city: "Mumbai", zone: "Asia/Kolkata", country: "India" },
      { city: "Singapore", zone: "Asia/Singapore", country: "Singapore" },
      { city: "Johannesburg", zone: "Africa/Johannesburg", country: "South Africa" },
      { city: "Cairo", zone: "Africa/Cairo", country: "Egypt" },
      { city: "Toronto", zone: "America/Toronto", country: "Canada" },
      { city: "San Francisco", zone: "America/Los_Angeles", country: "USA" },
      { city: "Chicago", zone: "America/Chicago", country: "USA" },
      { city: "Mexico City", zone: "America/Mexico_City", country: "Mexico" },
      { city: "Bangkok", zone: "Asia/Bangkok", country: "Thailand" },
      { city: "Beijing", zone: "Asia/Shanghai", country: "China" },
      { city: "Seoul", zone: "Asia/Seoul", country: "South Korea" },
      { city: "Rome", zone: "Europe/Rome", country: "Italy" },
      { city: "Madrid", zone: "Europe/Madrid", country: "Spain" },
      { city: "Amsterdam", zone: "Europe/Amsterdam", country: "Netherlands" },
      { city: "Istanbul", zone: "Europe/Istanbul", country: "Turkey" },
      { city: "Vienna", zone: "Europe/Vienna", country: "Austria" },
      { city: "Lisbon", zone: "Europe/Lisbon", country: "Portugal" },
      { city: "Zurich", zone: "Europe/Zurich", country: "Switzerland" },
      { city: "Budapest", zone: "Europe/Budapest", country: "Hungary" },
      { city: "Jakarta", zone: "Asia/Jakarta", country: "Indonesia" },
      { city: "Auckland", zone: "Pacific/Auckland", country: "New Zealand" },
      { city: "Honolulu", zone: "Pacific/Honolulu", country: "USA" },
      { city: "Reykjavik", zone: "Atlantic/Reykjavik", country: "Iceland" },
      { city: "Athens", zone: "Europe/Athens", country: "Greece" },
      { city: "Warsaw", zone: "Europe/Warsaw", country: "Poland" },
      { city: "Stockholm", zone: "Europe/Stockholm", country: "Sweden" },
      { city: "Oslo", zone: "Europe/Oslo", country: "Norway" },
      { city: "Helsinki", zone: "Europe/Helsinki", country: "Finland" },
      { city: "Brussels", zone: "Europe/Brussels", country: "Belgium" },
      { city: "Prague", zone: "Europe/Prague", country: "Czechia" },
      { city: "Budapest", zone: "Europe/Budapest", country: "Hungary" },
      { city: "Kuala Lumpur", zone: "Asia/Kuala_Lumpur", country: "Malaysia" },
      { city: "Lagos", zone: "Africa/Lagos", country: "Nigeria" },
      { city: "Buenos Aires", zone: "America/Argentina/Buenos_Aires", country: "Argentina" },
      { city: "Santiago", zone: "America/Santiago", country: "Chile" },
      { city: "Lima", zone: "America/Lima", country: "Peru" },
      { city: "Vancouver", zone: "America/Vancouver", country: "Canada" },
      { city: "Montreal", zone: "America/Montreal", country: "Canada" },
      { city: "Cape Town", zone: "Africa/Johannesburg", country: "South Africa" },
      { city: "Doha", zone: "Asia/Qatar", country: "Qatar" },
      { city: "Riyadh", zone: "Asia/Riyadh", country: "Saudi Arabia" },
      { city: "Tehran", zone: "Asia/Tehran", country: "Iran" },
      { city: "Baghdad", zone: "Asia/Baghdad", country: "Iraq" },
      { city: "Kuwait City", zone: "Asia/Kuwait", country: "Kuwait" },
      { city: "Jerusalem", zone: "Asia/Jerusalem", country: "Israel" },
      { city: "Istanbul", zone: "Europe/Istanbul", country: "Turkey" },
      { city: "Kiev", zone: "Europe/Kiev", country: "Ukraine" },
      { city: "Bucharest", zone: "Europe/Bucharest", country: "Romania" },
      { city: "Belgrade", zone: "Europe/Belgrade", country: "Serbia" },
      { city: "Sofia", zone: "Europe/Sofia", country: "Bulgaria" },
      { city: "Copenhagen", zone: "Europe/Copenhagen", country: "Denmark" },
      { city: "Tallinn", zone: "Europe/Tallinn", country: "Estonia" },
      { city: "Vilnius", zone: "Europe/Vilnius", country: "Lithuania" },
      { city: "Riga", zone: "Europe/Riga", country: "Latvia" },
    ];
  </script>
  <!-- Main App Logic -->
  <script>
    // ---- Persistence ----
    const STORAGE_KEY = "worldclock-v3";
    function saveState(state) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }
    function loadState() {
      let d = localStorage.getItem(STORAGE_KEY);
      return d ? JSON.parse(d) : { clocks: [], is24h: false };
    }

    // ---- UI State ----
    let state = loadState();

    // ---- DOM References ----
    const grid = document.getElementById("clocks-grid");
    const search = document.getElementById("search");
    const suggestions = document.getElementById("suggestions");
    const addBtn = document.getElementById("add-btn");
    const toggle24h = document.getElementById("toggle-24h");
    const toggleDark = document.getElementById("toggle-dark");
    const titleEl = document.getElementById("title");

    // ---- Utility ----
    function getCityMatch(q) {
      if (!q) return [];
      let t = q.trim().toLowerCase();
      return CITIES.filter(
        c =>
          c.city.toLowerCase().includes(t) ||
          c.zone.toLowerCase().includes(t) ||
          (c.country && c.country.toLowerCase().includes(t))
      ).slice(0, 12);
    }
    function findCityObj(val) {
      let t = val.trim().toLowerCase();
      return CITIES.find(
        c =>
          c.city.toLowerCase() === t ||
          c.zone.toLowerCase() === t
      );
    }
    function cityDisplay(c) {
      return `${c.city} (${c.zone.replace(/_/g," ")})`;
    }
    function genId(zone) {
      return zone.replace(/[\/_]/g, "-");
    }
    function isDarkMode() {
      return document.documentElement.classList.contains("dark");
    }

    // ---- Suggestion Dropdown ----
    let suggestIdx = -1;
    search.addEventListener("input", e => {
      let q = search.value;
      let matches = getCityMatch(q);
      suggestions.innerHTML = "";
      if (!q || matches.length === 0) {
        suggestions.classList.add("hidden");
        return;
      }
      matches.forEach((c, idx) => {
        let li = document.createElement("li");
        li.className = "px-4 py-2 cursor-pointer hover:bg-cyan-800/60";
        li.textContent = cityDisplay(c);
        li.addEventListener("mousedown", () => {
          search.value = c.city;
          suggestions.classList.add("hidden");
          search.focus();
        });
        suggestions.appendChild(li);
      });
      suggestions.classList.remove("hidden");
      suggestIdx = -1;
    });
    // Keyboard navigation for suggestions
    search.addEventListener("keydown", e => {
      let items = Array.from(suggestions.children);
      if(!items.length) return;
      if(e.key === "ArrowDown") {
        suggestIdx = (suggestIdx + 1) % items.length;
        items.forEach(i=>i.classList.remove("bg-cyan-800/60"));
        items[suggestIdx].classList.add("bg-cyan-800/60");
        e.preventDefault();
      } else if(e.key === "ArrowUp") {
        suggestIdx = (suggestIdx - 1 + items.length) % items.length;
        items.forEach(i=>i.classList.remove("bg-cyan-800/60"));
        items[suggestIdx].classList.add("bg-cyan-800/60");
        e.preventDefault();
      } else if(e.key === "Enter" && suggestIdx > -1) {
        search.value = items[suggestIdx].textContent.replace(/\s?\(.+$/, "");
        suggestions.classList.add("hidden");
        addBtn.focus();
        e.preventDefault();
      }
    });
    document.addEventListener("click", e => {
      if (!search.contains(e.target) && !suggestions.contains(e.target)) {
        suggestions.classList.add("hidden");
      }
    });

    // ---- Add Clock ----
    function handleAddClock() {
      let val = search.value.trim();
      let c = CITIES.find(ci => ci.city.toLowerCase() === val.toLowerCase() || ci.zone.toLowerCase() === val.toLowerCase());
      if (!c) {
        // Try partial match
        let matches = getCityMatch(val);
        if (matches.length) c = matches[0];
      }
      if (!c) {
        search.classList.add("ring-2", "ring-red-500");
        setTimeout(()=>search.classList.remove("ring-2", "ring-red-500"), 1000);
        return;
      }
      // Avoid duplicates
      if (state.clocks.some(z => z.zone === c.zone)) {
        search.value = "";
        return;
      }
      state.clocks.push({ city: c.city, zone: c.zone, country: c.country });
      saveState(state);
      search.value = "";
      renderClocks(true, c.zone); // Animate last added
    }
    addBtn.addEventListener("click", handleAddClock);
    search.addEventListener("keypress", e => {
      if (e.key === "Enter") handleAddClock();
    });

    // ---- Remove Clock ----
    function removeClock(zone) {
      let idx = state.clocks.findIndex(c => c.zone === zone);
      if (idx > -1) {
        // Animate out
        let el = document.getElementById("clock-" + genId(zone));
        gsap.to(el, { opacity: 0, y: 40, duration: 0.25, onComplete: () => {
          state.clocks.splice(idx,1);
          saveState(state);
          renderClocks();
        }});
      }
    }

    // ---- 12h/24h Toggle ----
    toggle24h.checked = state.is24h;
    toggle24h.addEventListener("change", () => {
      state.is24h = toggle24h.checked;
      saveState(state);
      renderClocks();
    });

    // ---- Dark/Light Mode Toggle ----
    // Prefer system on first load
    function setDarkMode(on) {
      document.documentElement.classList.toggle("dark", on);
      // Animate SVG icon switch
      document.getElementById("moon").style.display = on ? "none" : "";
      document.getElementById("sun").style.display = on ? "" : "none";
    }
    // Initial mode
    let prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    setDarkMode(localStorage.getItem("worldclock-dark") === "1" || (!("worldclock-dark" in localStorage) && prefersDark));
    toggleDark.addEventListener("click", () => {
      let on = !isDarkMode();
      setDarkMode(on);
      localStorage.setItem("worldclock-dark", on ? "1" : "0");
    });

    // ---- Clock Rendering ----
    let clockTimers = [];
    function renderClocks(animateNew=false, newlyAddedZone="") {
      // Stop previous timers
      clockTimers.forEach(t => clearInterval(t));
      clockTimers = [];
      // Render cards
      grid.innerHTML = "";
      if (!state.clocks.length) {
        let empty = document.createElement("div");
        empty.className = "col-span-full text-center text-cyan-400/60 py-10 italic";
        empty.innerHTML = "No clocks added. Search and add cities above!";
        grid.appendChild(empty);
        return;
      }
      state.clocks.forEach(({city,zone,country},i) => {
        let id = "clock-" + genId(zone);
        let card = document.createElement("div");
        card.className = `gsap-pop glass dark:glass-dark rounded-xl p-5 shadow-neon flex flex-col justify-between items-center relative group transition duration-200 select-none`;
        card.id = id;
        // Remove button
        let rmv = document.createElement("button");
        rmv.title = "Remove";
        rmv.className = "absolute top-2 right-2 opacity-70 group-hover:opacity-100 text-cyan-200 hover:text-red-400 text-xl font-bold transition-all";
        rmv.innerHTML = "&#10060;";
        rmv.addEventListener("click", ()=>removeClock(zone));
        card.appendChild(rmv);
        // City
        let cityEl = document.createElement("div");
        cityEl.className = "text-2xl md:text-3xl font-bold mb-2 text-cyan-100 tracking-wide text-center drop-shadow";
        cityEl.textContent = city;
        card.appendChild(cityEl);
        // Digital clock
        let timeEl = document.createElement("div");
        timeEl.className = "digital-time text-3xl md:text-4xl font-mono font-extrabold glow time-glow mb-1 transition-all";
        card.appendChild(timeEl);
        // Date
        let dateEl = document.createElement("div");
        dateEl.className = "text-md md:text-lg font-medium text-cyan-300/90 mb-2";
        card.appendChild(dateEl);
        // Country (optional)
        if (country) {
          let ct = document.createElement("div");
          ct.className = "text-xs text-cyan-400/70";
          ct.textContent = country;
          card.appendChild(ct);
        }
        grid.appendChild(card);
        // Animate
        if (animateNew && zone === newlyAddedZone) {
          gsap.fromTo(card, {opacity:0, scale:0.92, y:40}, {opacity:1, scale:1, y:0, duration:0.50, ease:"back.out(1.7)"});
        } else {
          gsap.fromTo(card, {opacity:0, scale:0.95, y:16}, {opacity:1, scale:1, y:0, delay:0.04*i, duration:0.45, ease:"power2.out"});
        }
        // Live update
        function updateClock() {
          let now = new Date();
          let opts = {
            hour: '2-digit', minute: '2-digit', second: '2-digit',
            hour12: !state.is24h, timeZone: zone
          };
          let timeStr = new Intl.DateTimeFormat('en-US', opts).format(now);
          timeEl.textContent = timeStr;
          // Animate glowing digits
          gsap.to(timeEl, {
            keyframes: [
              { textShadow: "0 0 16px #0ff0fc, 0 0 24px #818cf8", filter: "brightness(1.18)", duration:0.18, ease:"power1.inOut" },
              { textShadow: "0 0 8px #0ff0fc, 0 0 20px #818cf8", filter:"brightness(1)", duration:0.5, ease:"power1.inOut"}
            ]
          });
          // Date
          let dateFmt = new Intl.DateTimeFormat('en-US', {
            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
            timeZone: zone
          });
          dateEl.textContent = dateFmt.format(now);
        }
        updateClock();
        let t = setInterval(updateClock, 1000);
        clockTimers.push(t);
      });
    }

    // ---- GSAP Animations ----
    window.addEventListener("DOMContentLoaded", ()=>{
      // Title
      gsap.fromTo("#title", {opacity:0, scale:0.8, y:-32}, {opacity:1, scale:1, y:0, duration:0.9, ease:"expo.out"});
      // Footer links: hover effect
      document.querySelectorAll("footer a").forEach(a => {
        a.addEventListener("mouseenter", e => {
          gsap.to(a, {scale:1.16, textShadow:"0 0 8px #0ff0fc", duration:0.18});
        });
        a.addEventListener("mouseleave", e => {
          gsap.to(a, {scale:1, textShadow:"none", duration:0.18});
        });
      });
      renderClocks();
    });
  </script>
</body>
</html>